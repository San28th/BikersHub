<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Profile Page</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <!-- Custom Css -->
    <link rel="stylesheet" href="/templates/css/profile.css" />

    <!-- FontAwesome 5 -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css"
    />
  </head>
  <body>
    <!-- Navbar top -->
    <div class="navbar-top">
      <div class="title">
        <h1>User Profile</h1>
      </div>

      <!-- Navbar -->
      <ul>
        <li>
          <a href="/sign">
            <i class="fa fa-sign-out-alt fa-2x"></i>
          </a>
        </li>
      </ul>
      <!-- End -->
    </div>
    <!-- End -->

    <!-- Sidenav -->
    <div class="sidenav">
      <div class="profile">
        <img
          src="https://imdezcode.files.wordpress.com/2020/02/imdezcode-logo.png"
          alt=""
          width="100"
          height="100"
        />

        <div class="name">{{find.User}}</div>
        <div class="job">{{find.Email}}</div>
      </div>

      <div class="sidenav-url">
        <div class="url">
          <button
            class="btn btn-primary"
            type="button"
            onclick="editview1({{find.id}})"
          >
            Update Profile
          </button>
        </div>
        <br />
        <div class="url">
          <button
            type="submit"
            class="btn btn-primary"
            data-bs-toggle="modal"
            data-bs-target="#mod12"
          >
            Purchased Products
          </button>
        </div>
      </div>
    </div>
    <!-- End Sidenav -->

    <div class="main">
      <h2>IDENTITY</h2>
      <div class="card">
        <div class="card-body">
          <i class="fa fa-pen fa-xs edit"></i>
          <table>
            <tbody>
              <tr>
                <td>Name</td>
                <td>:</td>
                <td>{{find.User}}</td>
              </tr>
              <tr>
                <td>Email</td>
                <td>:</td>
                <td>{{find.Email}}</td>
              </tr>
              <tr>
                <td>Phone Number</td>
                <td>:</td>
                <td>{{find.Phone_Number}}</td>
              </tr>
              <!-- You may add more rows here if needed -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Modal -->
    <div
      class="modal fade"
      id="mod11"
      tabindex="-1"
      aria-labelledby="exampleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-fullscreen">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5">BikersHub</h1>
            <input type="hidden" class="form-control" id="id11" name="price2" />
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <span id="message"></span>
            <form class="row g-3">
              <div class="col-md-6">
                <label for="pname" class="form-label">Name</label>
                <input
                  type="text"
                  class="form-control"
                  id="name"
                  name="pname2"
                />
              </div>
              <div class="col-md-6">
                <label for="brand" class="form-label">Email</label>
                <input
                  type="text"
                  class="form-control"
                  id="email"
                  name="brand2"
                />
              </div>
              <div class="col-md-6">
                <label for="price" class="form-label">Phone Number</label>
                <input type="text" class="form-control" id="pn" name="price2" />
              </div>
              <div class="col-md-6">
                <label for="stock" class="form-label">Current Password</label>
                <input type="text" class="form-control" id="cp" name="stock2" />
              </div>
              <div class="col-md-6">
                <label for="stock" class="form-label">New Password</label>
                <input type="text" class="form-control" id="np" name="stock2" />
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" onclick="edit_val()">
              Update
            </button>
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Close
            </button>
          </div>
        </div>
      </div>
    </div>
    <div
      class="modal fade"
      id="mod12"
      tabindex="-1"
      aria-labelledby="exampleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-fullscreen">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5">Purchased Products</h1>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <span id="message"></span>
            <div class="content">
              <div class="con">
                {% for i in find2 %} {% set temp = [] %} {% for j in product %}
                {% if i.product_id == j.id and i.product_id not in temp %}
                <div class="card" style="width: 18rem">
                  <img
                    src="templates/images/{{ j.image }}"
                    height="300rem"
                    width="250rem"
                    class="card-img-top"
                    alt="..."
                  />
                  <div class="card-body">
                    <h5 class="card-title">
                      <b>Product: {{ j.product_name }}</b>
                    </h5>
                    <b>
                      <p class="card-text">Brand: {{ j.brand }}</p>
                      <p class="card-text">Price: {{ j.price }}</p>
                      <p class="card-text">Quantity: {{ i.quantity }}</p>
                    </b>
                  </div>
                </div>
                {% set _ = temp.append(i.product_id) %} {% endif %} {% endfor %}
                {% endfor %}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- End Modal -->
  </body>
</html>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script>
  function editview1(data) {
    var id = data;
    $.ajax({
      type: "put",
      url: "/put_formprofile/" + id,
      id: id,
      contentType: "application/json",
      success: function (data1) {
        $("#id11").val(data1.id);
        $("#name").val(data1.User),
          $("#email").val(data1.Email),
          $("#pn").val(data1.Phone_Number),
          $("#mod11").modal("show");
      },
    });
    return false;
  }
  function edit_val() {
    var formData = {
      edit_id: $("#id11").val(),
      Email: $("#email").val(),
      phonenum: $("#pn").val(),
      currpass: $("#cp").val(),
      newpass: $("#np").val(),
    };
    console.log(formData);
    $.ajax({
      type: "POST",
      url: "/update_value",
      data: formData,
      dataType: "json",
      encode: true,
    }).done(function (data) {
      if (data == "Done") {
        location.reload();
      }
    });
    event.preventDefault();
  }
</script>
